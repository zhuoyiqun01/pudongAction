# 如何导入参考案例到数据库

## 📌 重要说明

**参考案例是文本数据，存储在云数据库中，不是云存储！**

- ✅ **云数据库**（Cloud Database）- 存储文本、JSON 等结构化数据
- ✅ **云存储**（Cloud Storage）- 存储图片、视频等文件

## 🚀 快速导入（推荐）

### 方法 1: 一键自动导入

1. **部署临时云函数**：
   - 在微信开发者工具中部署 `exportCases` 云函数

2. **在小程序控制台运行**：
   ```javascript
   // 加载工具脚本
   const importTool = require('./utils/import-cases-complete.js')
   
   // 执行导入
   wx.importCasesComplete()
   ```

3. **等待导入完成**：
   - 工具会自动从 `cases.js` 读取数据
   - 批量导入到 `reference_cases` 数据库集合
   - 显示导入进度和结果

### 方法 2: 手动导入

1. **获取数据**：
   - 打开 `cloudfunctions/generateActionSuggestion/cases.js`
   - 复制 `REFERENCE_CASES` 数组的内容

2. **在小程序控制台运行**：
   ```javascript
   const importTool = require('./utils/import-reference-cases.js')
   
   // 粘贴数据数组
   const casesArray = [
     '邀请一位或多位社区里的伙伴一起进行一次社区观察',
     '在街坊群发起「社区老照片征集」...',
     // ... 粘贴所有案例
   ]
   
   // 导入
   importTool.importFromArray(casesArray).then(result => {
     console.log('导入完成:', result)
   })
   ```

### 方法 3: 使用云开发 CMS

1. **准备数据**：
   - 将 `cases.js` 中的数据转换为 Excel 或 JSON 格式
   - 格式：每行一个案例文本

2. **导入到 CMS**：
   - 打开云开发控制台 → CMS 内容管理
   - 选择 `reference_cases` 集合
   - 点击"导入数据"
   - 选择 Excel 或 JSON 文件导入

## 📋 数据库集合结构

### `reference_cases` 集合

**字段：**
- `text` (String) - 案例文本（必需）
- `case` (String) - 案例文本（兼容字段）
- `order` (Number) - 排序
- `createdAt` (Date) - 创建时间
- `updatedAt` (Date) - 更新时间

## ✅ 验证导入

导入完成后，验证数据：

1. **在云开发控制台查看**：
   - 打开数据库 → `reference_cases` 集合
   - 检查记录数量是否正确（应该有 119 条）

2. **测试云函数**：
   ```javascript
   wx.cloud.callFunction({
     name: 'getReferenceCases',
     success: res => {
       console.log('参考案例数量:', res.result.data.length)
     }
   })
   ```

3. **测试 AI 生成**：
   - 打开"小事生成器"页面
   - 输入关键词，生成建议
   - 如果生成正常，说明数据加载成功

## 🔧 故障排查

### 问题：导入失败

1. **检查云函数是否部署**：
   - 确保 `exportCases` 云函数已部署
   - 检查云函数日志是否有错误

2. **检查数据库权限**：
   - 确保 `reference_cases` 集合已创建
   - 检查数据库权限设置

3. **检查数据格式**：
   - 确保案例数据是字符串数组
   - 确保没有空值或格式错误

### 问题：数据重复

- 导入前会检查数据库中是否已有数据
- 如果已有数据，会询问是否继续导入
- 新导入的数据会追加到现有数据后面

## 📝 导入后操作

导入完成后，可以：

1. ✅ **删除临时云函数**：
   - `exportCases` 云函数可以删除（不再需要）

2. ✅ **删除本地文件**（可选）：
   - 如果确认数据库数据正常，可以删除 `cases.js` 文件
   - 这样可以减小云函数体积

3. ✅ **验证功能**：
   - 测试 AI 生成建议功能
   - 确保所有功能正常

## 💡 提示

- 参考案例数据存储在数据库中，可以随时通过 CMS 管理
- 修改案例数据不需要重新部署云函数
- 数据库中的数据会自动被 `generateActionSuggestion` 云函数使用



