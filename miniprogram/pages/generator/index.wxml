<view class="generator-page fade-in">
  <view class="header-area">
    <text class="title">社区小事生成器</text>
    <view class="sub-title-row">
      <text class="sub-title">你正在关注什么问题或话题？</text>
      <view class="change-topic-btn" bindtap="changeTopic">
        <text class="change-topic-text">换个话题</text>
      </view>
    </view>
  </view>

  <view class="input-area">
    <textarea 
      class="main-input" 
      placeholder="{{examplePlaceholder}}" 
      value="{{inputValue}}" 
      bindinput="onInput"
      auto-height
      maxlength="200"
      show-confirm-bar="{{false}}"
    />
    <button 
      class="generate-btn {{isLoading ? 'loading' : ''}}" 
      bindtap="generate" 
      disabled="{{isLoading}}"
    >
      {{isLoading ? 'AI 正在思考中...' : '生成创意点子'}}
    </button>
    <view class="ai-notice">由 AI 生成，仅供参考</view>
  </view>

  <view class="tags-area" wx:if="{{!showResult && !isLoading}}">
    <view class="tag-title">试试这些话题：</view>
    <view class="tag-list">
      <view 
        class="tag" 
        wx:for="{{hotTags}}" 
        wx:key="*this" 
        bindtap="onTagTap" 
        data-text="{{item}}"
      >
        #{{item}}
      </view>
    </view>
  </view>

  <view class="result-area" wx:if="{{showResult}}">
    <view class="result-header">生成结果</view>
    <view class="tip-text">点击卡片，生成分享图片</view>
    
    <block wx:for="{{suggestions}}" wx:key="index">
      <view class="suggestion-card level-{{item.level === '观察类' ? '0' : (item.level === '互动类' ? '1' : '2')}}">
        <view class="card-header">
          <view class="level-badge">
            <text class="badge-icon">{{categoryIcons[item.level]}}</text>
            <text>{{item.level}}</text>
          </view>
          <text class="card-title">{{item.title}}</text>
        </view>
          <view class="card-desc">{{item.desc}}</view>
        <button class="adopt-btn" bindtap="onViewDetail" data-index="{{index}}">分享</button>
      </view>
    </block>
    
    <view class="re-generate" bindtap="generate">不满意？换一批试试</view>
  </view>

  <!-- 详情弹窗 -->
  <view class="modal-mask" wx:if="{{showModal}}" bindtap="closeModal">
    <view class="modal-content" catchtap="preventBubble">
      <view class="modal-header">
        <view class="user-question">“ {{inputValue}} ”</view>
      </view>
      
      <view class="modal-body">
        <view class="idea-box">
          <view class="idea-label">
            <text>{{categoryIcons[selectedItem.level]}}</text>
            <text>{{selectedItem.level}}</text>
          </view>
          <view class="idea-title">{{selectedItem.title}}</view>
          <view class="idea-desc">{{selectedItem.desc}}</view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="footer-btn save-btn" bindtap="saveImage">保存卡片</button>
        <button class="footer-btn share-btn" open-type="share">分享小事生成器</button>
      </view>
      
      <view class="modal-close" bindtap="closeModal">✕</view>
    </view>
  </view>
  
  <view class="loading-area" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
  </view>

  <!-- 免责声明弹窗 -->
  <view class="disclaimer-mask" wx:if="{{showDisclaimer}}" bindtap="confirmDisclaimer">
    <view class="disclaimer-content" catchtap="preventBubble">
      <view class="disclaimer-title">使用须知</view>
      <view class="disclaimer-text">
        <text class="disclaimer-bold">本功能由 AI 生成内容，仅供参考。</text>
        <text>生成的建议为人工智能算法生成，可能存在不准确、不完整或不适用的内容。请您在使用时：</text>
        <text>1. 理性判断生成内容的适用性</text>
        <text>2. 结合实际情况调整建议</text>
        <text>3. 对生成内容的使用后果自行承担责任</text>
      </view>
      <button class="disclaimer-btn" bindtap="confirmDisclaimer">我知道了</button>
    </view>
  </view>

  <!-- 隐藏的画布，用于生成分享图片 -->
  <canvas type="2d" id="shareCanvas" canvas-id="shareCanvas" style="width: 600px; height: 800px; position: fixed; left: -2000px;"></canvas>
</view>
