<view class="home-page fade-in {{showSecondFloor ? 'lock-scroll' : ''}}">
  <!-- 二楼内容：社区小事是什么介绍 -->
  <view 
    class="second-floor {{showSecondFloor ? 'expand' : ''}}"
    bindtouchstart="touchStart"
    catchtouchmove="touchMove"
    bindtouchend="touchEnd"
    style="transform: translateY({{showSecondFloor ? secondFloorOffset : -windowHeight}}px); transition: {{isDragging ? 'none' : 'transform 0.5s cubic-bezier(0.19, 1, 0.22, 1)'}};"
  >
    <view class="hero-section">
      <view class="hero-primary">
        <view class="hero-content">
          <view class="hero-title-line">
            <text class="hero-title">在家门口的五十米，</text>
          </view>
          <view class="hero-title-line">
            <text class="hero-title-highlight">做一件小事</text>
          </view>
          <view class="hero-description">
            <view>2025年普陀区委社会工作部、团区委联合大鱼营造，在全区发起「社区小事」开放邻里计划。</view>
            <view>计划面向普陀区所有社区，招募期待在楼组、社区行动的在地生活者。鼓励人们回到身边最初五十米，关注那些细小、具体又温暖的"附近"。</view>
          </view>
        </view>
      </view>
    </view>
    <view class="second-floor-tip" bindtap="closeSecondFloor">向上滑动或点击进入首页 ↑</view>
  </view>

  <view 
    class="main-content {{showSecondFloor ? 'slide-down' : ''}}"
    style="{{showSecondFloor ? 'transform: translateY(' + (windowHeight + secondFloorOffset) + 'px);' : ''}} transition: {{isDragging ? 'none' : 'transform 0.5s cubic-bezier(0.19, 1, 0.22, 1)'}};"
  >
    <!-- 板块1: 社区小事是什么？-->
  <view class="section banner-section-wrapper">
    <view class="section-title banner-title">
      <text>社区小事是什么？</text>
      <text class="title-link" bindtap="onLearnMore">了解更多👉</text>
    </view>
    <view class="intro-subtitle">让小行动带来大改变</view>
    <view class="intro-section">
      <view class="feature-buttons">
        <view class="feature-btn generator-btn" bindtap="goToGenerator">
          <view class="btn-icon">💡</view>
          <view class="btn-title">生成你的社区点子</view>
        </view>

        <view class="feature-btn action-btn" bindtap="goToAction">
          <view class="btn-icon">🧩</view>
          <view class="btn-title">成为小事行动者</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 板块2: 正在发生 - 海报Banner -->
  <view class="section">
    <view class="section-title sticky-title">
      <text>正在发生</text>
      <text class="title-link" bindtap="goToActivities">查看更多小事活动 ></text>
    </view>
    <view class="banner-section">
      <swiper 
        wx:if="{{banners.length > 0}}" 
        class="banner-swiper" 
        indicator-dots="{{true}}" 
        indicator-color="#94a3b8" 
        indicator-active-color="#068D7B" 
        autoplay="{{true}}" 
        interval="3000" 
        duration="500" 
        circular="{{true}}" 
        previous-margin="80rpx" 
        next-margin="80rpx"
      >
      <swiper-item wx:for="{{banners}}" wx:key="index">
        <view class="swiper-item-inner">
          <image 
            wx:if="{{item.image && item.image !== ''}}" 
            src="{{item.image}}" 
            class="banner-image" 
            mode="aspectFill" 
            bindtap="onBannerTap" 
            data-id="{{item._id}}" 
          />
        </view>
      </swiper-item>
    </swiper>
    </view>
  </view>

  <!-- 板块3: 小事行动者墙 -->
  <view class="section">
    <view class="section-title sticky-title">小事行动者墙</view>
    <view class="wall-section">
      <view class="container">
        <!-- 筛选器 -->
        <view class="filter-container">
          <!-- 地区筛选 -->
          <view class="dropdown-filter">
            <view class="dropdown-trigger" bindtap="toggleRegionDropdown">
              <text class="dropdown-text">{{selectedRegionText}}</text>
              <view class="dropdown-arrow {{regionDropdownOpen ? 'open' : ''}}">▼</view>
            </view>
            <view class="dropdown-options {{regionDropdownOpen ? 'show' : ''}}">
              <view
                wx:for="{{regions}}"
                wx:key="_id"
                class="dropdown-option {{selectedRegion === item.id ? 'selected' : ''}}"
                bindtap="selectRegion"
                data-region="{{item.id}}"
              >
                {{item.name}}
              </view>
            </view>
          </view>

          <!-- 议题筛选 -->
          <view class="dropdown-filter">
            <view class="dropdown-trigger" bindtap="toggleTopicDropdown">
              <text class="dropdown-text">{{selectedTopicText}}</text>
              <view class="dropdown-arrow {{topicDropdownOpen ? 'open' : ''}}">▼</view>
            </view>
            <view class="dropdown-options {{topicDropdownOpen ? 'show' : ''}}">
              <view
                wx:for="{{topics}}"
                wx:key="_id"
                class="dropdown-option {{selectedTopic === item.id ? 'selected' : ''}}"
                bindtap="selectTopic"
                data-topic="{{item.id}}"
              >
                {{item.name}}
              </view>
            </view>
          </view>
        </view>

      <!-- 瀑布流内容 -->
      <view class="waterfall-container">
        <view class="waterfall-column">
          <action-card
            wx:for="{{leftColumn}}"
            wx:key="index"
            action="{{item}}"
            bind:click="viewActionDetail"
          />
        </view>

        <view class="waterfall-column">
          <action-card
            wx:for="{{rightColumn}}"
            wx:key="index"
            action="{{item}}"
            bind:click="viewActionDetail"
          />
        </view>
      </view>
    </view>
    </view>
  </view>
</view>
</view>
